---
layout: post
title:  第一个天气小程序Demo
date:   2018-12-25 11:44:00 
categories: Blog 
tag: Myblog
---

* content
{:toc}

写代码感受心得
===================
首先，写js文件注意要把不用改动的地方最小化，便于书写代码。再有，写代码就像写作文，不加润色难免会有点晦涩，对代码的润色叫重构。重构之后的代码，通俗易懂，便于维护。常见的重构方法就是把混乱的一片代码，通过函数包裹起来。

变量使用步骤
===================

* 1.命名变量的地方往往在wxml文件中，注意使用两个花括号括在一起
* 2.在`Page`下面的`data`函数中声明变量，并选填默认值（可以不填）
* 3.在`onLoad()`函数下的，相关方法下的，`success`参数下的，`this.setData`方法里面，对变量进行赋值
* 4.如果是需要映射变量，需要在`index.js`文件的开始部分声明，声明形式为： `const` 变量名`Map={json格式的映射}`，然后再在变量赋值的地方,以`“变量名Map[变量名]”`的形式作为变量值。
点点点实现方式`"backgroundTextStyle":"dark"`

有关下拉刷新
===================
* 首先，下拉刷新需要在app.json中声明"enablePullDownRefresh":true。
* 结束下拉刷新要在complete参数下声明。结束下拉刷新要在complete参数下声明。
* 小程序默认下拉刷新，是没有效果的，要出现三个点的话，其实现方式为
```js
"backgroundTextStyle":"dark"
```

函数封装
===================
当需要两段相同代码的时候，记得要用函数封装，减少冗余。
还有就是出现一大块特别混乱的代码的时候，可以拆解成多个函数，这样就把容易混淆的东西拆开来看了。

函数嵌套中的大bug
===================
本来js函数有两种写法，一种是传统写法，一种是后来写法：
```js
wx.getLocation({      
        success: function (res) {
		......
  }
})

wx.getLocation({      
        success: res=> {
		......
  }
})
```
小程序默认是支持者两种方法的，给的范例一般是第一种方法。所以按照范例去做往往会采用第一种方法。
可是今天就发现一个小bug，用了第一种写法在后面再次加入函数会出现第二个函数中的this方法无法使用。所以以后还是全部用第二种方法稳妥。
今天是第一次踩到这么深的坑，能从坑中爬出来也说明自己变强了。其实寻找差异也就这么一点差异了。往往越是意想不到的地方越是暗藏玄机的地方。

函数中嵌套函数，务必会出现两个这种形式，所以共有四种写法，经过测试只要是第一个采用第二种写法，就不会报错

后来又发现用第一种方法写的函数，函数中不得再放入其他函数，不管它有没有返回，就是最简单的setData也不允许，所以综上起见，放弃第一种写法吧，全部改用第二种写法。

小程序时间上的坑
===================
因为没写过js，不知道是不是所有js都一样，反正小程序的js日期参数很坑，月份不按中国的习惯，按照程序员的习惯来个`“0~11”`；星期按照欧美的习惯来了个`day`，几号就是`date`。后来查了查和js一样，好吧同宗同源。

三个等于号
===================
三个等于号可以判定你写代码的程度，如果这个都没遇到过应该不是一个合格的码农。
三个等于号可以理解成把两边的内容都按照字符处理了，如果不是相同字符则不等。
而两个等号则是判断左右两边的值真还是假，空字符或者`0`都会当做`false`处理。

硬盘存储路径
===================
硬盘存储的路径最好一开始就确定下来，否则更改路径，会导致编译异常，还要重新建空文件夹，重新开一个新的项目。

onShow小bug
===================
onShow是小程序的一个生命周期，理论上讲只要页面出现就会被执行，不过如果不在`app.js`中加入`App({})`，则`onShow`就和`onLoad`一样了，这是一年前的bug，到现在还这么放着，也是醉了。

真机调试
===================
得亏有教程，所以在面对问题时才不迷茫。明明都挺好的，放到真机赏测试居然和模拟器不一样。我立马想到的是我手机的问题，想立刻换个手机。其实这个在教程中写的很明确，就可惜视频里只字不提，醉醉的。可见真机和模拟器还是有差异的，总之这也是小程序软件的bug吧。

最后的大bug
===================
越是感觉成功近在咫尺的时候，越是要小心谨慎，有可能你认为的成功其实是功败垂成。真机调试的时候城市的位置始终获取不到，我就逐个排查代码，发现getlocation执行不到。后来想到是微信没有位置权限，然后专门开了一下权限，结果还是不行。我就试了一下需要位置信息的小程序：滴滴。结果滴滴都获取不到，还愣是让我手动输入地址，不得不给这个小程序点差评。然后瞬间成功的曙光一闪而过，原因是我手机没开位置权限，这年代怕费电不开位置的可能也就我了吧（回头可以调查一下），但是微信也是，就不弄个弹窗说明一下手机没开位置权限，也是醉醉的了。

一个小warning
===================
自从在视图里用上`wx:for` 就有个warning始终跟随左右，挥之不去，就像一个狗皮膏药似的项目。临近尾声，想要除掉这个东东，于是乎查了一下，还以为多复杂，其实就是在后面加上个`wx:key=""`就行，至于等于啥，我看随便舔就行，也不知道有啥用。

添加域名
===================
访问网络，域名是必不可少的，微信小程序出于安全考虑对域名有严格限制。果然添加以后，编译还是报错。本以为域名需要折腾一下子，结果清楚全部缓存后，立马好了，现在控制台很干净，一个warning都没有了。可最后结果可谓是一波三折，我只是还没触发这个bug，一点位置获取的按钮立马bug又现身了。

视图污染
===================
昨天在设计视图的时候就在思考一个问题，如果在父视图，和子视图上分别绑定不同的点击事件，那么，点击子视图会按照父视图去操作还是子视图呢？按照正常的逻辑应该会选择子视图。那么问题又来了，如果两个子视图重叠了呢，那么应该会按照最后渲染的结果，也就是后面的自视图。

开发工具的bug?
===================
小程序毕竟是腾讯家的东西，开发工具更是如此。难怪腾讯谈不上必出良品，小程序就可见一斑。在真机上调试就没问题，可是在开发工具上总是有问题，清除缓存有时候都不管用，好在有时候就管用了，也不知道什么鬼

静态加载的实现
===================
此次更新主要是实现了自己能选择中英日韩语言。本着精益求精的态度，虽然实现了，但是每一次加载还有去请求一次数据，请求数据的部分本来就不需要刷新，结果还是刷新了，很不尽如人意。一开始的时候，不了解刷新的机制，于是就测试了一下发现只有在wxml的文件第一次被加载的时候才会刷新这个页面，不然是不会刷新的。最后还是把两块视图拆开来进行渲染了。

两次重大失误
===================
今天在绘制视图时，两次重大失误，都是把名字拼错了。也是习惯了，JetBrains的产品，每次声明一个变量以后，在后面都可以拿来用。而腾讯这个并不友好，避免写错的最好办法，就是复制粘贴，这个要牢记。

数组调用外部参数
===================
在实现可以选择四种语言的时候，遇到了四种语言的Map数组表加载问题。借鉴了一个网上的做法把数组表放在不同的JS文件中，然后暴露接口，在需要的时候引入接口。如果引用函数的话，会有所区别。命名数组和函数返回参数的暴露方法如下：
```js
module.exports = { WeekdayMap: WeekdayMap }
```

```js
module.exports.getPeakHeight = getPeakHeight
```

调用其他函数中的参数
===================
在一般的程序语言中，调用其他函数中的参数都是先在其他函数中`return`这个参数，然后再另一个函数中引用即可。因为小程序特殊的数据结构，所采取的方法有些特殊。先把这个参数赋值给`data`数组，然后通过 `this.data.参数` 的方法引用该数组